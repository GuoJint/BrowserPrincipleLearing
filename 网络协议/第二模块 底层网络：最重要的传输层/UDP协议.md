### TCP 和 UDP 有哪些区别？

1. 什么叫面向连接，什么叫无连接呢？
在互通之前，面向连接的协议会先建立连接。例如，TCP 会三次握手，而 UDP 不会。

2. 为什么要建立连接呢？
你 TCP 三次握手，我 UDP 也可以发三个包玩玩，有什么区别吗？
所谓的建立连接，是为了在客户端和服务端维护连接，而建立一定的数据结构来维护双方交互的状态，用这样的数据结构来保证所谓的面向连接的特性。
	- TCP 提供可靠交付。通过 TCP 连接传输的数据，无差错、不丢失、不重复、并且按序到达。
	我们都知道 IP 包是没有任何可靠性保证的，一旦发出去，就像西天取经，走丢了、被妖怪吃了，都只能随它去。但是 TCP 号称能做到那个连接维护的程序做的事情
	- TCP 是面向字节流的。发送的时候发的是一个流，没头没尾
	我们都知道 IP 包是没有任何可靠性保证的，一旦发出去，就像西天取经，走丢了、被妖怪吃了，都只能随它去。但是 TCP 号称能做到那个连接维护的程序做的事情
	- TCP 是可以有拥塞控制的。
	它意识到包丢弃了或者网络的环境不好了，就会根据情况调整自己的行为，看看是不是发快了，要不要发慢点。
	- UDP 继承了 IP 包的特性，不保证不丢失，不保证按顺序到达。
	- UDP 继承了 IP 的特性，基于数据报的，一个一个地发，一个一个地收。
	- UDP 就不会，应用让我发，我就发，管它洪水滔天。
因而 TCP 其实是一个有状态服务，通俗地讲就是有脑子的，里面精确地记着发送了没有，接收到没有，发送到哪个了，应该接收哪个了，错一点儿都不行。而 UDP 则是无状态服务。通俗地说是没脑子的，天真无邪的，发出去就发出去了。

3. UDP
	- UDP 包头是什么样的？
	在 IP 头里面有个 8 位协议，这里会存放，数据里面到底是 TCP 还是 UDP。
	当我们看到 UDP 包头的时候，发现的确有端口号，有源端口号和目标端口号。因为是两端通信嘛，这很好理解。但是你还会发现，UDP 除了端口号，再没有其他的了。
	- UDP 的三大特点
	第一，沟通简单，不需要一肚子花花肠子（大量的数据结构、处理逻辑、包头字段）。前提是它相信网络世界是美好的，秉承性善论，相信网络通路默认就是很容易送达的，不容易被丢弃的。
	
	第二，轻信他人。它不会建立连接，虽然有端口号，但是监听在这个地方，谁都可以传给他数据，他也可以传给任何人数据，甚至可以同时传给多个人数据。
	
	第三，愣头青，做事不懂权变。不知道什么时候该坚持，什么时候该退让。它不会根据网络的情况进行发包的拥塞控制，无论网络丢包丢成啥样了，它该怎么发还怎么发。
	- 使用场景
	第一，需要资源少，在网络情况比较好的内网，或者对于丢包不敏感的应用。
	DHCP 就是基于 UDP 协议的。
	PXE 可以在启动的时候自动安装操作系统，操作系统镜像的下载使用的 TFTP，这个也是基于 UDP 协议的。在还没有操作系统的时候，客户端拥有的资源很少，不适合维护一个复杂的状态机，而且因为是内网，一般也没啥问题。
	
	第二，不需要一对一沟通，建立连接，而是可以广播的应用。
	UDP 的不面向连接的功能，可以使得可以承载广播或者多播的协议。DHCP 就是一种广播的形式，就是基于 UDP 协议的。
	
	第三，需要处理速度快，时延低，可以容忍少数丢包，但是要求即便网络拥塞，也毫不退缩，一往无前的时候。
	UDP 简单、处理速度快，不像 TCP 那样，操这么多的心，各种重传啊，保证顺序啊，前面的不收到，后面的没法处理啊。不然等这些事情做完了，时延早就上去了。而 TCP 在网络不好出现丢包的时候，拥塞控制策略会主动的退缩，降低发送速度，这就相当于本来环境就差，还自断臂膀，用户本来就卡，这下更卡了。
	
	- 自定义UDP协议来解决多个问题
	网页或者 APP 的访问
	QUIC（全称 Quick UDP Internet Connections，快速 UDP 互联网连接）是 Google 提出的一种基于 UDP 改进的通信协议，其目的是降低网络通信的延迟，提供更好的用户互动体验。
	如果使用基于TCP的HTTP协议来实现的话对于时延比较大的移动互联网来说，建立一次连接的时间会比较长，TCP甚至可能会断了重连，同时TCP的严格顺序策略导致即便后一个数据来了也得等待后一个数据。种种原因使用TCP的话时延会大大增加
	
	流媒体的协议
	很多直播应用，都基于 UDP 实现了自己的视频传输协议。
	直播协议多使用 RTMP，RTMP 协议也是基于 TCP 的，而TCP的可靠交付，以及拥塞控制会导致有时候当一个包丢失时会重新发送，同时后面的包还必须等待前面的包到达，如果前面的包老是没来就等着，卡顿了，新的也看不了，那就会丢失客户，所以直播，实时性比较比较重要，宁可丢包，也不要卡顿的。有时候一个包很关键但有时候并不关键，所以当网络不好时应适当的丢失不关键的包。
	还有就是当网络不好的时候，TCP 协议会主动降低发送速度，这对本来当时就卡的看视频来讲是要命的，应该应用层马上重传，而不是主动让步。
	
	实时游戏
	游戏对实时要求较为严格的情况下，采用自定义的可靠 UDP 协议，自定义重传策略，能够把丢包产生的延迟降到最低，尽量减少网络问题对游戏性造成的影响。
	实时游戏更不用说，在网络环境一定的情况下必须保证实时传输，使用TCP如果出现一个数据包丢失，所有事情都需要停下来等待这个数据包重发。客户端会出现等待接收数据，然而玩家并不关心过期的数据，激战中卡 1 秒，等能动了都已经死了。
	
	IoT 物联网
	Google 旗下的 Nest 建立 Thread Group，推出了物联网通信协议 Thread，就是基于 UDP 协议的。
	一方面，物联网领域终端资源少，很可能只是个内存非常小的嵌入式系统，而维护 TCP 协议代价太大；另一方面，物联网对实时性要求也很高，而 TCP 还是因为上面的那些原因导致时延大。
	
	移动通信领域
	移动流量上网的数据面对的协议 GTP-U 是基于 UDP 的。因为移动网络协议比较复杂，而 GTP 协议本身就包含复杂的手机上线下线的通信协议。如果基于 TCP，TCP 的机制就显得非常多余


